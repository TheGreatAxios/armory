# Entire CLI hooks
entire hooks git pre-push "$1" || true

# Changeset check for main/staging branches
check_changeset() {
  while read local_ref local_sha remote_ref remote_sha; do
    branch="${remote_ref#refs/heads/}"

    if [ "$branch" = "main" ] || [ "$branch" = "staging" ]; then
      if git diff --name-only HEAD~1 HEAD | grep -q "^packages/"; then
        if ! git diff --name-only HEAD~1 HEAD | grep -q "^\.changeset/.*\.md$"; then
          echo ""
          echo "No changeset found for packages/* changes"
          echo "  Run: bun run changeset"
          echo "  Skip: git push --no-verify"
          echo ""
          exit 1
        fi
      fi
    fi
  done
}

check_changeset
