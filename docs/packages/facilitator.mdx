---
description: Payment verification and on-chain settlement
---

# @armory/facilitator

Verify payments and settle them on-chain via EIP-3009.

## Installation

```bash
bun add @armory/facilitator
```

## Key Exports

```typescript
import {
  verifyPayment,
  settlePayment,
  createMemoryQueue,
  createNonceTracker,
  createFacilitatorServer,
  PaymentVerificationError,
  InvalidSignatureError,
} from '@armory/facilitator';
```

## Verification

```typescript
import { verifyPayment } from '@armory/facilitator';

const result = await verifyPayment(payload, {
  walletClient,
  publicClient,
  nonceTracker,
  acceptedNetworks: ['base', 'ethereum'],
  token: TOKENS.USDC_BASE,
});

if (result.success) {
  console.log('Payment valid:', result.data);
}
```

## Settlement

```typescript
import { settlePayment } from '@armory/facilitator';

const receipt = await settlePayment({
  walletClient,
  publicClient,
  payload: result.data,
  token: TOKENS.USDC_BASE,
});
```

## HTTP Server

```typescript
import { createFacilitatorServer } from '@armory/facilitator';

const server = createFacilitatorServer({
  port: 3000,
  walletClient,
  publicClient,
  nonceTracker,
});

await server.start();
```

## Error Handling

```typescript
import {
  InvalidSignatureError,
  InsufficientBalanceError,
  NonceUsedError,
  PaymentExpiredError,
} from '@armory/facilitator';

try {
  await verifyPayment(payload, options);
} catch (error) {
  if (error instanceof InvalidSignatureError) {
    console.error('Invalid signature');
  }
}
```
